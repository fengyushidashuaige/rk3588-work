# ç¼–è¯‘å™¨é…ç½®
CROSS_COMPILE = aarch64-linux-gnu-
CC = $(CROSS_COMPILE)gcc
CXX = $(CROSS_COMPILE)g++

# ç¼–è¯‘é€‰é¡¹
CFLAGS = -Wall -O2 -static
TARGET_IP = 192.168.137.3
TARGET_USER = firefly

# æºæ–‡ä»¶å’Œç›®æ ‡
SRC_DIR = ../src
BUILD_DIR = .
DEPLOY_DIR = ../deploy

# ç›®æ ‡ç¨‹åº
TARGETS = hello_arm uart_test_arm

# é»˜è®¤ç›®æ ‡ï¼šç¼–è¯‘æ‰€æœ‰
all: $(TARGETS)

uart6_sender_test: $(SRC_DIR)/uart6_sender_test.c
	$(CC) $(CFLAGS) -o $@ $<

uart6_interrupt_test: $(SRC_DIR)/uart6_interrupt_test.c uart6_interrupt_system.c
	$(CC) $(CFLAGS) -o $@ $^ $(LDFLAGS)
# ç¼–è¯‘hello_arm
hello_arm: $(SRC_DIR)/hello.c
	$(CC) $(CFLAGS) -o $@ $<
	@echo "âœ… ç¼–è¯‘å®Œæˆ: $@"

# ç¼–è¯‘receiverå’Œsender
receiver: $(SRC_DIR)/receiver.c
	$(CC) $(CFLAGS) -o $@ $<
	@echo "âœ… ç¼–è¯‘å®Œæˆ: $@"


# ç¼–è¯‘sender
sender: $(SRC_DIR)/sender.c
	$(CC) $(CFLAGS) -o $@ $<
	@echo "âœ… ç¼–è¯‘å®Œæˆ: $@"


# ç¼–è¯‘UARTæµ‹è¯•ç¨‹åº
uart_test_arm: $(SRC_DIR)/uart_test.c
	$(CC) $(CFLAGS) -o $@ $<
	@echo "âœ… ç¼–è¯‘å®Œæˆ: $@"

# éƒ¨ç½²ç›®æ ‡ - ä¾èµ–äºhello_arm
deploy: hello_arm
	@echo "ğŸš€ éƒ¨ç½²åˆ°ç›®æ ‡æ¿..."
	@cd $(DEPLOY_DIR) && ./deploy.sh
	@echo "ğŸ‰ éƒ¨ç½²å®Œæˆ!"

# éƒ¨ç½²UARTæµ‹è¯•ç¨‹åº
deploy-uart: uart_test_arm
	@echo "ğŸš€ éƒ¨ç½²UARTæµ‹è¯•ç¨‹åº..."
	scp uart_test_arm $(TARGET_USER)@$(TARGET_IP):/tmp/
	ssh $(TARGET_USER)@$(TARGET_IP) "chmod +x /tmp/uart_test_arm && /tmp/uart_test_arm"
	@echo "ğŸ‰ UARTæµ‹è¯•ç¨‹åºéƒ¨ç½²å®Œæˆ!"

# æ¸…ç†ç¼–è¯‘ç»“æœ
clean:
	rm -f $(TARGETS)
	@echo "ğŸ§¹ æ¸…ç†å®Œæˆ"

# æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
help:
	@echo "å¯ç”¨ç›®æ ‡:"
	@echo "  all         - ç¼–è¯‘æ‰€æœ‰ç›®æ ‡ç¨‹åº"
	@echo "  hello_arm   - ç¼–è¯‘Hello Worldç¨‹åº"
	@echo "  uart_test_arm - ç¼–è¯‘UARTæµ‹è¯•ç¨‹åº"
	@echo "  deploy      - ç¼–è¯‘å¹¶éƒ¨ç½²Hello Worldç¨‹åº"
	@echo "  deploy-uart - ç¼–è¯‘å¹¶éƒ¨ç½²UARTæµ‹è¯•ç¨‹åº"
	@echo "  clean       - æ¸…ç†ç¼–è¯‘ç»“æœ"
	@echo "  help        - æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯"

# å£°æ˜ä¼ªç›®æ ‡
.PHONY: all deploy deploy-uart clean help